#!/usr/bin/env bash

for relay in $(gnostr-get-relays -s);do
WEEBLE=$(gnostr-weeble)
WOBBLE=$(gnostr-wobble)
BLOCK_HEIGHT=$(gnostr-blockheight)
echo $relay$WEEBLE$BLOCK_HEIGHT
PRIV_KEY=$(gnostr-sha256 $relay$WEEBLE$BLOCK_HEIGHT)
echo $PRIV_KEY
./gnostr-nip --sec $PRIV_KEY | gnostr-post-event --relay $relay & sleep 1 || true
nostril --sec $PRIV_KEY \
--kind 30617 \
--pow 8 \
--tag d "$(gnostr-sha256 nostril)" \
--tag name "<human-readable project name>" \
--tag description "brief human-readable project description>" \
--tag web "<url for browsing>" \
--tag web "<url for browsing>" \
--tag clone "<url for git-cloning>" \
--tag clone "<url for git-cloning>" \
--tag clone "<url for git-cloning>" \
--tag relays "$relay" \
--tag r $(git rev-parse --short HEAD~0) \
--tag r $(git rev-parse         HEAD~0) \
--tag topic $(git rev-parse         HEAD~0) \
--tag maintainers "<other-recognized-maintainer>" \
--tag maintainers "<other-recognized-maintainer>"  \
-t gnostr \
-t $relay \
-t $(gnostr-weeble) \
-t $(gnostr-blockheight) \
-t $(gnostr-wobble) \
--content "$relay/$(gnostr-weeble)/$(gnostr-blockheight)/$(git rev-parse HEAD~0):$(gnostr-diff)" | \
gnostr-post-event --relay $relay & sleep 3; \
done
